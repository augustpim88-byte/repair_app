<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix-It Fast | ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        body { font-family: 'Kanit', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 mb-10">

    <nav class="bg-slate-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="max-w-md mx-auto flex items-center gap-3">
            <i class="fas fa-tools text-xl text-blue-400"></i>
            <h1 class="text-xl font-bold">Fix-It Fast</h1>
        </div>
    </nav>

    <main class="max-w-md mx-auto p-4">
        <form id="repairForm" class="bg-white rounded-3xl shadow-xl p-6 space-y-5 border border-gray-100">
            <div class="text-center">
                <h2 class="text-xl font-bold text-gray-800">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ä‡∏≥‡∏£‡∏∏‡∏î</h2>
            </div>

            <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</label>
                <label for="fileInput" class="border-2 border-dashed border-gray-300 rounded-2xl p-4 flex flex-col items-center justify-center bg-gray-50 cursor-pointer hover:bg-blue-50 transition">
                    <div id="uploadPlaceholder">
                        <i class="fas fa-camera text-3xl text-gray-400 mb-2"></i>
                        <p class="text-xs text-gray-500">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                    </div>
                    <img id="preview" class="hidden max-h-48 rounded-lg shadow-md">
                    <input type="file" id="fileInput" accept="image/*" class="hidden">
                </label>
            </div>

            <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                <select id="category" required class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">‚ö° ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
                    <option value="‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏õ‡∏≤">üíß ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏õ‡∏≤</option>
                    <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®">‚ùÑÔ∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</option>
                    <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">üì¶ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
            </div>

            <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á</label>
                <input type="text" id="location" required placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤" class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</label>
                <select id="priority" class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="‡∏õ‡∏Å‡∏ï‡∏¥">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                    <option value="‡∏î‡πà‡∏ß‡∏ô">‡∏î‡πà‡∏ß‡∏ô</option>
                    <option value="‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å">‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å</option>
                </select>
            </div>

            <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</label>
                <textarea id="details" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢..." class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                <i class="fas fa-paper-plane"></i>
                <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</span>
            </button>
        </form>
    </main>

    <script>
        // *** ‡∏ß‡∏≤‡∏á URL ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ***
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzc_tgZchksbLZS1zcMgR4YcVB5gY11AfiSbAanGiyJWGuPXkpKRnORNZjhR6X9x7Mg4w/exec'; 

        const form = document.getElementById('repairForm');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        let base64String = "";

        fileInput.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = () => {
                base64String = reader.result;
                preview.src = reader.result;
                preview.classList.remove('hidden');
                uploadPlaceholder.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        };

        async function compressImage(base64) {
            return new Promise(resolve => {
                const img = new Image();
                img.src = base64;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 600; 
                    let scale = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scale;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.6));
                };
            });
        }

        form.addEventListener('submit', async e => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

            const payload = new URLSearchParams();
            payload.append('category', document.getElementById('category').value);
            payload.append('location', document.getElementById('location').value);
            payload.append('priority', document.getElementById('priority').value);
            payload.append('details', document.getElementById('details').value);

            if (base64String) {
                const compressed = await compressImage(base64String);
                payload.append('fileData', compressed);
                payload.append('fileName', fileInput.files[0].name);
            }

            fetch(scriptURL, { method: 'POST', body: payload.toString() })
            .then(res => res.text())
            .then(text => {
                if(text === "Success") {
                    alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                    location.reload();
                } else {
                    alert("‚ùå ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: " + text);
                    btn.disabled = false;
                }
            })
            .catch(err => {
                alert("‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err);
                btn.disabled = false;
            });
        });
    </script>
</body>
</html>